# 機能要件仕様書 - Zoom Video Mover

## 概要

本文書は、Zoom Video Moverプロジェクトの機能要件（Functional Requirements）を定義します。
各機能要件は、システムが提供すべき具体的な機能とその詳細を記述しており、要件定義方針に基づいて体系的に整理されています。

## 機能要件分類体系

### FR001: 認証・設定管理

#### 概要
- **目的**: Zoom API アクセスに必要な認証機能
- **重要度**: 必須（システムの基盤機能）
- **複雑度**: 中（OAuth 2.0仕様の複雑性）
- **RDRA Layer**: システム価値層・システム境界層

#### 詳細機能要件

##### FR001-1: OAuth 2.0認証フロー
- **要件**: Zoom APIアクセス用のOAuth 2.0認証を実装する
- **受け入れ基準**: 
  - 認証URLが正常に生成される
  - ブラウザ起動と認証コード取得が動作する
  - アクセストークンが正常に取得・保存される
  - CSRF対策（stateパラメータ）が実装されている
- **実装優先度**: 必須
- **依存関係**: FR001-2（設定管理）

##### FR001-2: 設定管理（Client ID/Secret）
- **要件**: OAuth認証に必要な設定情報を管理する
- **受け入れ基準**:
  - config.tomlファイルでの設定保存・読み込み
  - 設定値の検証とエラー表示
  - 初回起動時のサンプル設定生成
- **実装優先度**: 必須
- **依存関係**: なし

##### FR001-3: トークン管理・更新
- **要件**: アクセストークンの有効性管理と自動更新を行う
- **受け入れ基準**:
  - トークン有効期限の監視
  - リフレッシュトークンによる自動更新
  - 無効トークン時の再認証促進
- **実装優先度**: 必須
- **依存関係**: FR001-1（認証フロー）

##### FR001-4: 認証URL生成・処理
- **要件**: OAuth認証用URLの生成と表示を行う
- **受け入れ基準**:
  - 設定からパラメータを読み込み有効なURLを生成
  - ブラウザの自動起動
  - URLのクリップボードコピー機能
- **実装優先度**: 必須
- **依存関係**: FR001-2（設定管理）

### FR002: データ取得・検索

#### 概要
- **目的**: Zoom録画データの効率的な取得
- **重要度**: 必須（コア機能）
- **複雑度**: 中（API仕様・ページネーション）
- **RDRA Layer**: システム外部環境層・システム境界層

#### 詳細機能要件

##### FR002-1: Zoom API呼び出し
- **要件**: Zoom Cloud Recording APIを使用して録画リストを取得する
- **受け入れ基準**:
  - `/users/me/recordings`エンドポイントの正常呼び出し
  - Bearer token認証の実装
  - レート制限の遵守
  - ページネーション対応
- **実装優先度**: 必須
- **依存関係**: FR001-1（OAuth認証）

##### FR002-2: 録画リスト表示
- **要件**: 取得した録画リストをGUIで表示する
- **受け入れ基準**:
  - 階層表示（ミーティング > ファイル）
  - ファイル種別・サイズ・日時の表示
  - チェックボックスによる選択機能
- **実装優先度**: 必須
- **依存関係**: FR002-1（API呼び出し）、FR005-1（GUI）

##### FR002-3: 期間フィルタリング
- **要件**: 指定期間の録画のみを検索・表示する
- **受け入れ基準**:
  - 開始日・終了日の指定（YYYY-MM-DD形式）
  - 日付形式の検証
  - 期間範囲制限（最大1年）
  - デフォルト期間設定（過去30日）
- **実装優先度**: 必須
- **依存関係**: FR002-1（API呼び出し）

##### FR002-4: ページネーション処理
- **要件**: 大量の録画データを効率的に処理する
- **受け入れ基準**:
  - 自動ページ切り替え
  - 進捗表示
  - メモリ効率的な処理
- **実装優先度**: 必須
- **依存関係**: FR002-1（API呼び出し）

### FR003: ファイル処理

#### 概要
- **目的**: 効率的で信頼性の高いファイルダウンロード
- **重要度**: 必須（コア機能）
- **複雑度**: 高（並列処理・進捗管理・エラー処理）
- **RDRA Layer**: システム層

#### 詳細機能要件

##### FR003-1: 並列ダウンロード
- **要件**: 複数ファイルの効率的な並列ダウンロードを実行する
- **受け入れ基準**:
  - tokio非同期処理の使用
  - 同時ダウンロード数制限（デフォルト: 5）
  - レジューム機能（中断からの再開）
  - チャンク単位ダウンロード
- **実装優先度**: 必須
- **依存関係**: FR002-2（ファイル選択）

##### FR003-2: 進捗表示・制御
- **要件**: ダウンロード進捗をリアルタイムで表示する
- **受け入れ基準**:
  - 全体進捗バーとファイル別進捗バー
  - 転送速度・残り時間表示
  - 完了ファイル数・総容量表示
  - 一時停止・再開・キャンセル機能
- **実装優先度**: 必須
- **依存関係**: FR003-1（並列ダウンロード）、FR005-1（GUI）

##### FR003-3: ファイル種別対応
- **要件**: 様々な録画ファイル形式に対応する
- **受け入れ基準**:
  - 動画ファイル（MP4、MOV等）
  - 音声ファイル（MP3、M4A等）
  - テキストファイル（チャット、トランスクリプト）
  - JSON形式（AI要約、メタデータ）
  - ファイル整合性の検証
- **実装優先度**: 必須
- **依存関係**: FR003-1（並列ダウンロード）

##### FR003-4: ファイル名管理
- **要件**: 適切なファイル名でのローカル保存を行う
- **受け入れ基準**:
  - Windows対応ファイル名サニタイズ
  - 日本語ファイル名対応
  - 重複ファイル名の自動リネーム
  - フォルダ構造の自動生成
- **実装優先度**: 必須
- **依存関係**: FR003-1（並列ダウンロード）

### FR004: AI機能連携

#### 概要
- **目的**: Zoom AI Companionとの連携機能
- **重要度**: 高（付加価値機能）
- **複雑度**: 高（API仕様の不安定性）
- **RDRA Layer**: システム外部環境層・システム境界層

#### 詳細機能要件

##### FR004-1: AI要約API呼び出し
- **要件**: Zoom AI Companion生成の会議要約を取得する
- **受け入れ基準**:
  - 複数エンドポイント試行（UUID/ID変形対応）
  - レート制限・エラーハンドリング
  - デバッグレスポンス保存
  - フォールバック処理
- **実装優先度**: 高
- **依存関係**: FR001-1（OAuth認証）、FR002-1（API呼び出し）

##### FR004-2: 要約データ構造化
- **要件**: AI要約データの構造化と保存を行う
- **受け入れ基準**:
  - JSON形式での要約保存
  - キーポイント・アクションアイテム抽出
  - 参加者サマリー表示
  - 多言語対応（日本語・英語）
- **実装優先度**: 高
- **依存関係**: FR004-1（AI要約API呼び出し）

### FR005: ユーザーインターフェース

#### 概要
- **目的**: 直感的で効率的な操作環境
- **重要度**: 必須（ユーザビリティ）
- **複雑度**: 中（GUI状態管理）
- **RDRA Layer**: システム境界層

#### 詳細機能要件

##### FR005-1: GUIアプリケーション
- **要件**: egui/eframeベースの統合GUIを提供する
- **受け入れ基準**:
  - タブベースのナビゲーション
  - 状態管理とメッセージング
  - Windows環境最適化
  - リアルタイム更新
- **実装優先度**: 必須
- **依存関係**: なし

##### FR005-2: 設定画面
- **要件**: OAuth設定の入力・編集画面を提供する
- **受け入れ基準**:
  - Client ID/Secret入力フィールド
  - 出力ディレクトリ選択
  - 設定保存・読み込み機能
  - 入力検証とエラー表示
- **実装優先度**: 必須
- **依存関係**: FR001-2（設定管理）、FR005-1（GUIアプリケーション）

##### FR005-3: ファイル選択機能
- **要件**: 録画ファイルの選択・管理画面を提供する
- **受け入れ基準**:
  - 階層チェックボックス
  - 全選択・部分選択
  - ファイルサイズ計算
  - プレビュー機能
- **実装優先度**: 必須
- **依存関係**: FR002-2（録画リスト表示）、FR005-1（GUIアプリケーション）

### FR006: コマンドライン対応

#### 概要
- **目的**: 自動化・バッチ処理への対応
- **重要度**: 中（運用効率化）
- **複雑度**: 低（既存機能の再利用）
- **RDRA Layer**: システム境界層

#### 詳細機能要件

##### FR006-1: CLI実行機能
- **要件**: GUIなしでのコマンドライン実行を支援する
- **受け入れ基準**:
  - 引数による操作指定
  - 非対話モード
  - バッチ処理対応
  - プログレスバー表示
- **実装優先度**: 中
- **依存関係**: FR001（認証）、FR002（データ取得）、FR003（ファイル処理）

## 機能要件間の依存関係

### 依存関係マトリックス

| 要件ID | 依存先要件 | 依存関係の性質 |
|--------|------------|---------------|
| FR001-1 | FR001-2 | 設定情報が認証に必要 |
| FR001-3 | FR001-1 | 認証完了後にトークン管理 |
| FR001-4 | FR001-2 | 設定情報からURL生成 |
| FR002-1 | FR001-1 | 認証トークンでAPI呼び出し |
| FR002-2 | FR002-1, FR005-1 | APIデータをGUIで表示 |
| FR002-3 | FR002-1 | フィルタ条件でAPI呼び出し |
| FR002-4 | FR002-1 | ページネーション処理 |
| FR003-1 | FR002-2 | 選択されたファイルをダウンロード |
| FR003-2 | FR003-1, FR005-1 | ダウンロード状況をGUIで表示 |
| FR003-3 | FR003-1 | ファイル種別に応じた処理 |
| FR003-4 | FR003-1 | ダウンロード時のファイル名処理 |
| FR004-1 | FR001-1, FR002-1 | 認証・API基盤でAI要約取得 |
| FR004-2 | FR004-1 | AI要約データの構造化 |
| FR005-2 | FR001-2, FR005-1 | 設定機能のGUI提供 |
| FR005-3 | FR002-2, FR005-1 | 録画リストのGUI提供 |
| FR006-1 | FR001, FR002, FR003 | 全機能のCLI提供 |

## 優先度・実装順序

### Phase 1: 基盤機能（必須）
1. FR001-2: 設定管理
2. FR001-1: OAuth認証フロー
3. FR005-1: GUIアプリケーション基盤
4. FR005-2: 設定画面

### Phase 2: コア機能（必須）
5. FR002-1: Zoom API呼び出し
6. FR002-2: 録画リスト表示
7. FR002-3: 期間フィルタリング
8. FR005-3: ファイル選択機能

### Phase 3: ダウンロード機能（必須）
9. FR003-1: 並列ダウンロード
10. FR003-2: 進捗表示・制御
11. FR003-3: ファイル種別対応
12. FR003-4: ファイル名管理

### Phase 4: 高度機能（高優先度）
13. FR001-3: トークン管理・更新
14. FR001-4: 認証URL生成・処理
15. FR002-4: ページネーション処理
16. FR004-1: AI要約API呼び出し
17. FR004-2: 要約データ構造化

### Phase 5: 拡張機能（中優先度）
18. FR006-1: CLI実行機能

## トレーサビリティ

本機能要件は以下の文書と密接に関連しています：

- **要件定義方針** (`requirements_policy.md`): RDRA手法による要件分析フレームワーク
- **システム要求仕様** (`system_requirements_summary.md`): 具体的な受け入れ基準と実装状況
- **設計方針** (`../design/design_policy.md`): アーキテクチャ設計への反映
- **実装方針** (`../implementation/implementation_policy.md`): 実装レベルでの具現化
- **テスト方針** (`../testing/testing_policy.md`): Property-basedテストによる検証

## 変更管理

機能要件の変更は、要件定義方針に定められた変更管理プロセスに従って実施されます：

1. **変更要求の記録**: 背景・理由・期待効果の明確化
2. **影響分析**: 依存関係マトリックスによる影響範囲特定
3. **コスト・リスク評価**: 実装工数・品質リスクの評価
4. **変更承認**: 影響度に応じた承認レベル
5. **変更実装**: 設計・実装・テストの更新
6. **変更確認**: 変更効果の検証

## 結論

本機能要件仕様書は、Zoom Video Moverプロジェクトの全機能要件を体系的に定義し、RDRA手法による分析結果を反映しています。各要件は明確な受け入れ基準を持ち、依存関係と実装優先度が明確化されており、効率的な開発を可能にします。