# RDRA要件定義モデル図 - Zoom Video Mover

## RDRA（Requirements Definition and Requirements Architecture）概要

RDRAは以下の6つのモデル図で要件を整理します：
1. **システム価値体系図**：システムの目的と価値
2. **システムコンテキスト図**：システムと外部環境の関係
3. **ビジネスフロー図**：業務の流れ
4. **ビジネスユースケース図**：利用者の業務目的
5. **要求仕様書**：機能要求と非機能要求
6. **システム方式設計書**：アーキテクチャ設計

---

## 1. システム価値体系図

```
【ビジネス価値】
┌─────────────────────────────────────────────┐
│                   価値                      │
├─────────────────────────────────────────────┤
│ ■ Zoom会議録画の効率的な管理・保存           │
│ ■ 会議内容の長期アーカイブ化                │
│ ■ チーム知識の蓄積・共有促進                │
│ ■ コンプライアンス要件への対応              │
└─────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────┐
│                  目的                       │
├─────────────────────────────────────────────┤
│ ● Zoomクラウド録画の自動ローカル保存         │
│ ● 録画ファイルの一括ダウンロード             │
│ ● AI要約・トランスクリプトの取得             │
│ ● Windows環境での安定動作                   │
└─────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────┐
│               システム機能                   │
├─────────────────────────────────────────────┤
│ ◆ OAuth認証によるZoom API連携               │
│ ◆ 録画ファイル一覧取得・選択                │
│ ◆ 動画・音声・チャット・要約DL               │
│ ◆ GUI/CLI両対応のユーザーIF                 │
└─────────────────────────────────────────────┘
```

## 2. システムコンテキスト図

```
【外部システム・アクター】

    ┌─────────────┐              ┌─────────────────┐
    │             │              │                 │
    │  エンドユーザー │◄─────────────┤  Zoom Video     │
    │ (会議主催者)   │              │    Mover        │
    │             │──────────────►│                 │
    └─────────────┘              │   [本システム]    │
                                 │                 │
    ┌─────────────┐              │                 │
    │             │              │                 │
    │  Zoom Cloud  │◄─────────────┤                 │
    │  Recording   │              │                 │
    │   API       │──────────────►│                 │
    └─────────────┘              └─────────────────┘
                                           │
    ┌─────────────┐                       │
    │             │                       │
    │ ローカル      │◄──────────────────────┘
    │ ファイル      │
    │ システム      │
    └─────────────┘

【境界・責任】
┌────────────────────────────────────────────┐
│ システム境界                                │
├────────────────────────────────────────────┤
│ 内部：認証、ダウンロード、ファイル管理        │
│ 外部：Zoom API、OAuth認証、ローカルFS        │
└────────────────────────────────────────────┘
```

## 3. ビジネスフロー図

```
【録画ダウンロードフロー】

開始
 │
 ▼
┌─────────────┐
│ 1. 初期設定   │
│ ・OAuth設定  │
│ ・認証情報   │
└─────────────┘
 │
 ▼
┌─────────────┐      NG    ┌─────────────┐
│ 2. Zoom認証  │ ◄─────────│ エラー表示   │
│ ・OAuth実行  │            │ ・再試行     │
└─────────────┘            └─────────────┘
 │ OK
 ▼
┌─────────────┐
│ 3. 録画一覧  │
│ ・API呼出し  │
│ ・一覧表示   │
└─────────────┘
 │
 ▼
┌─────────────┐
│ 4. 録画選択  │
│ ・ファイル選択│
│ ・保存先指定 │
└─────────────┘
 │
 ▼
┌─────────────┐      NG    ┌─────────────┐
│ 5. ダウンロード│ ◄─────────│ リトライ     │
│ ・並列DL実行 │            │ ・エラー処理 │
│ ・進捗表示   │            └─────────────┘
└─────────────┘
 │ OK
 ▼
┌─────────────┐
│ 6. 完了通知  │
│ ・結果表示   │
│ ・ログ出力   │
└─────────────┘
 │
 ▼
終了
```

## 4. ビジネスユースケース図

```
【アクターとユースケース】

  ┌─────────────┐
  │             │
  │ 会議主催者    │ ─────┐
  │             │      │
  └─────────────┘      │
                        │     ┌──────────────────────┐
  ┌─────────────┐      │     │                      │
  │             │      ├────►│  UC1: 録画ダウンロード │
  │ システム管理者 │ ─────┤     │                      │
  │             │      │     └──────────────────────┘
  └─────────────┘      │
                        │     ┌──────────────────────┐
  ┌─────────────┐      │     │                      │
  │             │      ├────►│  UC2: システム設定    │
  │ IT管理者     │ ─────┘     │                      │
  │             │            └──────────────────────┘
  └─────────────┘
                              ┌──────────────────────┐
                              │                      │
                              │  UC3: 認証管理       │
                              │                      │
                              └──────────────────────┘

【詳細ユースケース】
UC1: 録画ダウンロード
- 基本フロー：認証→一覧取得→選択→ダウンロード
- 代替フロー：認証失敗、ネットワークエラー、容量不足
- 事前条件：OAuth設定済み、Zoom録画存在
- 事後条件：録画ファイルがローカルに保存

UC2: システム設定
- 基本フロー：設定画面→パラメータ入力→保存
- 対象設定：OAuth、保存先、ログレベル
- 事前条件：管理者権限
- 事後条件：設定ファイル更新

UC3: 認証管理
- 基本フロー：認証情報入力→OAuth実行→トークン取得
- 代替フロー：認証失敗、権限不足
- 事前条件：Zoom Developer App設定
- 事後条件：有効なアクセストークン取得
```

## 5. 要求仕様書

### 5.1 機能要求

| ID | 機能名 | 詳細 | 優先度 |
|---|--------|------|--------|
| FR001 | OAuth認証 | Zoom API OAuth 2.0認証 | 高 |
| FR002 | 録画一覧取得 | Zoom Cloud Recording一覧API | 高 |
| FR003 | ファイルダウンロード | 動画・音声・チャット・AI要約 | 高 |
| FR004 | GUI操作 | egui/eframeによる操作画面 | 中 |
| FR005 | CLI操作 | コマンドライン実行モード | 中 |
| FR006 | 進捗表示 | ダウンロード進捗リアルタイム表示 | 中 |
| FR007 | エラーハンドリング | 詳細なエラー情報と回復処理 | 高 |
| FR008 | 設定管理 | config.tomlによる設定永続化 | 高 |

### 5.2 非機能要求

| ID | 分類 | 要求 | 基準 |
|---|------|------|------|
| NFR001 | 性能 | 同時ダウンロード数 | 最大5並列 |
| NFR002 | 性能 | レスポンス時間 | API呼出し3秒以内 |
| NFR003 | 可用性 | エラー回復 | 自動リトライ3回 |
| NFR004 | セキュリティ | 認証情報保護 | ローカル暗号化保存 |
| NFR005 | 互換性 | Windows対応 | Windows 10以降 |
| NFR006 | 使いやすさ | 日本語対応 | 文字化けなし |
| NFR007 | 保守性 | ログ出力 | デバッグレベル対応 |
| NFR008 | 拡張性 | アーキテクチャ | モジュール分離設計 |

## 6. システム方式設計書

### 6.1 アーキテクチャ概要

```
【レイヤー構成】

┌─────────────────────────────────────────────┐
│               UI Layer                      │
├─────────────────┬───────────────────────────┤
│   CLI Interface │     GUI Interface         │
│   (main.rs)     │   (main_gui.rs/gui.rs)    │
└─────────────────┴───────────────────────────┘
                    │
┌─────────────────────────────────────────────┐
│            Business Logic Layer             │
├─────────────────────────────────────────────┤
│ ・OAuth認証処理 (lib.rs)                     │
│ ・録画一覧取得                               │
│ ・ファイルダウンロード                        │
│ ・設定管理                                   │
└─────────────────────────────────────────────┘
                    │
┌─────────────────────────────────────────────┐
│           Infrastructure Layer              │
├─────────────────────────────────────────────┤
│ ・HTTP Client (reqwest)                     │
│ ・OAuth Client (oauth2)                     │
│ ・File System                               │
│ ・Configuration (toml)                      │
│ ・Windows Console (windows crate)           │
└─────────────────────────────────────────────┘
```

### 6.2 技術選定

| 分類 | 技術 | 理由 |
|------|------|------|
| 言語 | Rust | 型安全性、性能、並行処理 |
| 非同期 | tokio | Rust標準の非同期ランタイム |
| HTTP | reqwest | OAuth対応、JSON処理 |
| GUI | egui/eframe | Rust native、軽量 |
| OAuth | oauth2 crate | 標準準拠、セキュア |
| 設定 | TOML | 人間可読、型安全 |
| ログ | env_logger | 環境変数制御、標準的 |

### 6.3 データフロー

```
【OAuth認証フロー】
User → Browser → Zoom OAuth → Callback → App → Access Token

【ダウンロードフロー】  
App → Zoom API → Recording List → User Selection → 
Parallel Download → Local Files

【設定フロー】
config.toml ← App Configuration → Runtime Settings
```

### 6.4 エラー処理戦略

```rust
// エラー型定義
enum ZoomVideoMoverError {
    AuthenticationError(String),
    NetworkError(reqwest::Error),
    FileSystemError(std::io::Error),
    ConfigurationError(String),
    ZoomApiError { code: u16, message: String },
}

// リトライ戦略
- 認証エラー: ユーザー再入力要求
- ネットワークエラー: 指数バックオフで3回リトライ
- ファイルシステムエラー: 権限確認とパス検証
- API制限エラー: レート制限待機
```

---

## モデル図の関係性

1. **価値体系図** → システムの存在理由と価値を明確化
2. **コンテキスト図** → システム境界と外部依存関係を定義
3. **ビジネスフロー図** → 実際の業務プロセスを可視化
4. **ユースケース図** → 利用者視点での機能要求を整理
5. **要求仕様書** → 機能・非機能要求を体系的に管理
6. **システム方式設計** → アーキテクチャと技術的実現方法を設計

これらのモデル図により、Zoom Video Moverプロジェクトの要件を多角的かつ体系的に整理しています。