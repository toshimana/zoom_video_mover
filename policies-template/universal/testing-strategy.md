---
reusability: universal
version: 1.0.0
dependencies: []
customizable:
  - test_cases
  - coverage_target
  - test_framework
---

# テスト戦略ポリシー - {{PROJECT_NAME}}

## 目的
{{PROJECT_NAME}}における体系的で効果的なテスト戦略の確立

## テストピラミッド

```
        /\        E2Eテスト (10%)
       /  \       - ユーザーシナリオ
      /    \      - システム全体の動作
     /      \     
    /________\    統合テスト (30%)
   /          \   - モジュール間連携
  /            \  - 外部サービス連携
 /              \ 
/________________\ 単体テスト (60%)
                   - 個別関数/メソッド
                   - ビジネスロジック
```

## テストカバレッジ目標

| テストタイプ | カバレッジ目標 | 測定方法 |
|-------------|---------------|----------|
| 単体テスト | {{COVERAGE_TARGET}}% | 行カバレッジ |
| 統合テスト | {{COVERAGE_TARGET * 0.8}}% | 機能カバレッジ |
| E2Eテスト | 主要シナリオ100% | シナリオカバレッジ |

## テスト作成ガイドライン

### 単体テスト

#### 命名規則
```
test_[テスト対象]_[条件]_[期待結果]

例:
test_calculate_total_with_discount_returns_discounted_price
test_validate_email_with_invalid_format_returns_error
```

#### テストケース設計
- **正常系**: 期待される入力での動作
- **異常系**: エラー処理、例外処理
- **境界値**: 最小値、最大値、null/empty
- **エッジケース**: 特殊な条件の組み合わせ

### Property-basedテスト

```{{LANGUAGE}}
// 例：任意の入力に対する不変条件のテスト
property_test(|input: TestInput| {
    let result = function_under_test(input);
    // 不変条件をアサート
    assert!(invariant_condition(result));
});
```

**最小テストケース数**: {{TEST_CASES}}

### 統合テスト

#### 対象範囲
- API エンドポイント
- データベース操作
- 外部サービス連携
- ファイルI/O

#### モック戦略
```
本物を使用:
- データベース（テスト用）
- ファイルシステム

モック化:
- 外部API
- 支払いサービス
- メール送信
```

### E2Eテスト

#### 主要シナリオ
1. ユーザー登録 → ログイン → 主要機能実行
2. エラー回復シナリオ
3. パフォーマンス限界テスト

## テスト実行戦略

### ローカル開発
```bash
# 高速フィードバック（1分以内）
{{TEST_COMMAND}} --quick

# 通常テスト（5分以内）
{{TEST_COMMAND}}

# 完全テスト（10分以内）
{{TEST_COMMAND}} --all
```

### CI/CD パイプライン
```yaml
stages:
  - quick-test:    # コミット時（1分）
      - 単体テスト（サンプリング）
      - リント
  
  - full-test:     # PR時（5分）
      - 全単体テスト
      - 統合テスト
      
  - release-test:  # リリース前（15分）
      - 全テスト
      - E2Eテスト
      - パフォーマンステスト
```

## テストデータ管理

### フィクスチャ
```
fixtures/
├── unit/          # 単体テスト用
├── integration/   # 統合テスト用
└── e2e/          # E2Eテスト用
```

### テストデータ生成
- **Builder パターン**: 複雑なオブジェクト生成
- **Factory パターン**: 標準的なテストデータ
- **Faker**: ランダムだが現実的なデータ

## パフォーマンステスト

### ベンチマーク基準
| 操作 | 目標応答時間 | 許容最大時間 |
|------|-------------|-------------|
| API呼び出し | 200ms | 1000ms |
| データベースクエリ | 50ms | 200ms |
| ページロード | 1秒 | 3秒 |

### 負荷テスト
- 同時接続数: {{LOAD_TEST_USERS}}
- 持続時間: {{LOAD_TEST_DURATION}}
- 成功率目標: 99.9%

## テストのベストプラクティス

### DO
- ✅ 1つのテストで1つの事をテスト
- ✅ テストを独立させる（順序依存なし）
- ✅ 意味のあるテスト名を付ける
- ✅ Arrange-Act-Assert パターンを使用
- ✅ テストの実行時間を短く保つ

### DON'T
- ❌ 実装の詳細をテストしない
- ❌ ランダムな値に依存しない（シード固定）
- ❌ sleepやwaitを避ける
- ❌ 巨大なテストを書かない
- ❌ コメントアウトされたテストを残さない

## テスト失敗時の対応

1. **再現性の確認**: 一貫して失敗するか
2. **原因特定**: 最小再現コードを作成
3. **修正**: テストファーストで修正
4. **回帰テスト追加**: 同じ問題の再発防止

## メトリクス

### 追跡指標
- テストカバレッジ率
- テスト実行時間
- テスト失敗率
- 不安定なテスト（Flaky test）の数

### 改善目標
- カバレッジ: 四半期ごとに+5%
- 実行時間: 月次で10%短縮
- Flaky test: ゼロを維持

---
**適用日**: {{POLICY_EFFECTIVE_DATE}}  
**レビュー周期**: 四半期ごと